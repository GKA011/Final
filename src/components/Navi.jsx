import React, { useEffect, useState, useRef } from "react";
import "ol/ol.css";
import { Map, View } from "ol";
import { Feature } from "ol";
import { LineString, Point } from "ol/geom";
import { Vector as VectorLayer } from "ol/layer";
import { Vector as VectorSource } from "ol/source";
import { Style, Stroke, Icon } from "ol/style";
import ImageLayer from "ol/layer/Image";
import Static from "ol/source/ImageStatic";
import Box from "@mui/material/Box";
import TextField from "@mui/material/TextField";
import Button from "@mui/material/Button";
import Typography from "@mui/material/Typography";
import CircularProgress from "@mui/material/CircularProgress";
import Snackbar from "@mui/material/Snackbar";
import { Alert } from "@mui/material";

// Graph data structure with transition nodes marked
const graph = {
"629,79,1": { "627,101,1": 22.09, "598,101,1": 38.01 },
"627,101,1": { "629,79,1": 22.09, "598,101,1": 29.00, "643,125,1": 28.84 },
"665,120,1": { "688,131,1": 25.50, "643,125,1": 22.56, "650,140,1": 25.00 },
"688,131,1": { "665,120,1": 25.50, "719,143,1": 33.24, "722,128,1": 34.13, "650,140,1": 39.05 },
"719,143,1": { "688,131,1": 33.24, "742,157,1": 26.93, "722,128,1": 15.30, "725,111,1": 32.56 },
"742,157,1": { "719,143,1": 26.93, "767,166,1": 26.57, "722,128,1": 35.23 },
"767,166,1": { "742,157,1": 26.57, "782,177,1": 18.60, "764,205,1": 39.12, "768,190,1": 24.02 },
"782,177,1": { "767,166,1": 18.60, "811,189,1": 31.38, "814,171,1": 32.56, "764,205,1": 33.29, "768,190,1": 19.10 },
"811,189,1": { "782,177,1": 31.38, "836,195,1": 25.71, "814,171,1": 18.25, "821,157,1": 33.53 },
"836,195,1": { "811,189,1": 25.71, "853,201,1": 18.03, "814,171,1": 32.56, "862,225,1": 39.70 },
"853,201,1": { "836,195,1": 18.03, "877,209,1": 25.30, "854,238,1": 37.01, "862,225,1": 25.63 },
"722,128,1": { "688,131,1": 34.13, "719,143,1": 15.30, "742,157,1": 35.23, "725,111,1": 17.26 },
"725,111,1": { "719,143,1": 32.56, "722,128,1": 17.26 },
"814,171,1": { "782,177,1": 32.56, "811,189,1": 18.25, "836,195,1": 32.56, "821,157,1": 15.65, "827,144,1": 29.97 },
"821,157,1": { "811,189,1": 33.53, "814,171,1": 15.65, "827,144,1": 14.32 },
"827,144,1": { "814,171,1": 29.97, "821,157,1": 14.32 },
"877,209,1": { "853,201,1": 25.30, "895,216,1": 19.31, "904,220,1": 29.15, "910,224,1": 36.25, "854,238,1": 37.01, "862,225,1": 21.93 },
"895,216,1": { "877,209,1": 19.31, "904,220,1": 9.85, "910,224,1": 17.00, "923,230,1": 31.30, "862,225,1": 34.21, "916,238,1": 30.41, "913,249,1": 37.59 },
"904,220,1": { "877,209,1": 29.15, "895,216,1": 9.85, "910,224,1": 7.21, "923,230,1": 21.47, "932,239,1": 33.84, "916,238,1": 21.63, "913,249,1": 30.36 },
"910,224,1": { "877,209,1": 36.25, "895,216,1": 17.00, "904,220,1": 7.21, "923,230,1": 14.32, "932,239,1": 26.63, "916,238,1": 15.23, "913,249,1": 25.18 },
"923,230,1": { "895,216,1": 31.30, "904,220,1": 21.47, "910,224,1": 14.32, "932,239,1": 12.73, "944,247,1": 27.02, "916,238,1": 10.63, "913,249,1": 21.47, "910,266,1": 38.28 },
"932,239,1": { "904,220,1": 33.84, "910,224,1": 26.63, "923,230,1": 12.73, "944,247,1": 14.42, "953,257,1": 27.66, "967,255,1": 38.48, "916,238,1": 16.03, "913,249,1": 21.47, "910,266,1": 34.83 },
"944,247,1": { "923,230,1": 27.02, "932,239,1": 14.42, "953,257,1": 13.45, "964,273,1": 32.80, "967,255,1": 24.35, "976,250,1": 32.14, "983,246,1": 39.01, "916,238,1": 29.41, "913,249,1": 31.06, "910,266,1": 38.95 },
"953,257,1": { "932,239,1": 27.66, "944,247,1": 13.45, "964,273,1": 19.42, "972,291,1": 38.95, "967,255,1": 14.14, "976,250,1": 24.04, "983,246,1": 31.95 },
"964,273,1": { "944,247,1": 32.80, "953,257,1": 19.42, "972,291,1": 19.70, "967,255,1": 18.25, "976,250,1": 25.94, "983,246,1": 33.02, "975,303,1": 31.95 },
"972,291,1": { "953,257,1": 38.95, "964,273,1": 19.70, "967,255,1": 36.35, "975,303,1": 12.37, "975,319,1": 28.16, "975,329,1": 38.12 },
"852,247,1": { "854,238,1": 9.22, "862,225,1": 24.17 },
"854,238,1": { "853,201,1": 37.01, "877,209,1": 37.01, "852,247,1": 9.22, "862,225,1": 15.26 },
"862,225,1": { "836,195,1": 39.70, "853,201,1": 25.63, "877,209,1": 21.93, "895,216,1": 34.21, "852,247,1": 24.17, "854,238,1": 15.26 },
"753,251,1": { "756,234,1": 17.26, "759,222,1": 29.61, "719,245,1": 34.53, "739,242,1": 16.64 },
"756,234,1": { "753,251,1": 17.26, "759,222,1": 12.37, "764,205,1": 30.08, "719,245,1": 38.60, "739,242,1": 18.79 },
"759,222,1": { "753,251,1": 29.61, "756,234,1": 12.37, "764,205,1": 17.72, "768,190,1": 33.24, "739,242,1": 28.28 },
"764,205,1": { "767,166,1": 39.12, "782,177,1": 33.29, "756,234,1": 30.08, "759,222,1": 17.72, "768,190,1": 15.52 },
"768,190,1": { "767,166,1": 24.02, "782,177,1": 19.10, "759,222,1": 33.24, "764,205,1": 15.52 },
"967,255,1": { "932,239,1": 38.48, "944,247,1": 24.35, "953,257,1": 14.14, "964,273,1": 18.25, "972,291,1": 36.35, "976,250,1": 10.30, "983,246,1": 18.36, "994,237,1": 32.45 },
"976,250,1": { "944,247,1": 32.14, "953,257,1": 24.04, "964,273,1": 25.94, "967,255,1": 10.30, "983,246,1": 8.06, "994,237,1": 22.20, "1003,230,1": 33.60 },
"983,246,1": { "944,247,1": 39.01, "953,257,1": 31.95, "964,273,1": 33.02, "967,255,1": 18.36, "976,250,1": 8.06, "994,237,1": 14.21, "1003,230,1": 25.61 },
"994,237,1": { "967,255,1": 32.45, "976,250,1": 22.20, "983,246,1": 14.21, "1003,230,1": 11.40 },
"1003,230,1": { "976,250,1": 33.60, "983,246,1": 25.61, "994,237,1": 11.40 },
"975,303,1": { "964,273,1": 31.95, "972,291,1": 12.37, "975,319,1": 16.00, "975,329,1": 26.00, "975,342,1": 39.00 },
"975,319,1": { "972,291,1": 28.16, "975,303,1": 16.00, "975,329,1": 10.00, "975,342,1": 23.00, "975,352,1": 33.00, "951,351,1": 40.00, "962,351,1": 34.54 },
"975,329,1": { "972,291,1": 38.12, "975,303,1": 26.00, "975,319,1": 10.00, "975,342,1": 13.00, "975,352,1": 23.00, "974,368,1": 39.01, "951,351,1": 32.56, "962,351,1": 25.55 },
"975,342,1": { "975,303,1": 39.00, "975,319,1": 23.00, "975,329,1": 13.00, "975,352,1": 10.00, "974,368,1": 26.02, "974,381,1": 39.01, "951,351,1": 25.63, "962,351,1": 15.81, "941,353,1": 35.74 },
"975,352,1": { "975,319,1": 33.00, "975,329,1": 23.00, "975,342,1": 10.00, "974,368,1": 16.03, "974,381,1": 29.02, "951,351,1": 24.02, "962,351,1": 13.04, "941,353,1": 34.01 },
"974,368,1": { "975,329,1": 39.01, "975,342,1": 26.02, "975,352,1": 16.03, "974,381,1": 13.00, "972,397,1": 29.07, "951,351,1": 28.60, "962,351,1": 20.81, "941,353,1": 36.25 },
"974,381,1": { "975,342,1": 39.01, "975,352,1": 29.02, "974,368,1": 13.00, "972,397,1": 16.12, "970,412,1": 31.26, "951,351,1": 37.80, "962,351,1": 32.31 },
"972,397,1": { "974,368,1": 29.07, "974,381,1": 16.12, "970,412,1": 15.13, "966,423,1": 26.68, "959,432,1": 37.34 },
"970,412,1": { "974,381,1": 31.26, "972,397,1": 15.13, "966,423,1": 11.70, "959,432,1": 22.83, "948,443,1": 38.01, "969,444,1": 32.02, "977,449,1": 37.66 },
"966,423,1": { "972,397,1": 26.68, "970,412,1": 11.70, "959,432,1": 11.40, "948,443,1": 26.91, "969,444,1": 21.21, "977,449,1": 28.23, "987,455,1": 38.28 },
"959,432,1": { "972,397,1": 37.34, "970,412,1": 22.83, "966,423,1": 11.40, "948,443,1": 15.56, "933,452,1": 32.80, "969,444,1": 15.62, "977,449,1": 24.76, "987,455,1": 36.24 },
"948,443,1": { "970,412,1": 38.01, "966,423,1": 26.91, "959,432,1": 15.56, "933,452,1": 17.49, "924,459,1": 28.84, "969,444,1": 21.02, "977,449,1": 29.61 },
"933,452,1": { "959,432,1": 32.80, "948,443,1": 17.49, "924,459,1": 11.40, "969,444,1": 36.88, "911,467,1": 26.63, "902,472,1": 36.89, "896,462,1": 38.33, "896,446,1": 37.48, "897,435,1": 39.81 },
"924,459,1": { "948,443,1": 28.84, "933,452,1": 11.40, "911,467,1": 15.26, "902,472,1": 25.55, "896,462,1": 28.16, "896,446,1": 30.87, "897,435,1": 36.12 },
"969,444,1": { "970,412,1": 32.02, "966,423,1": 21.21, "959,432,1": 15.62, "948,443,1": 21.02, "933,452,1": 36.88, "977,449,1": 9.43, "987,455,1": 21.10, "1000,463,1": 36.36 },
"977,449,1": { "970,412,1": 37.66, "966,423,1": 28.23, "959,432,1": 24.76, "948,443,1": 29.61, "969,444,1": 9.43, "987,455,1": 11.66, "1000,463,1": 26.93 },
"987,455,1": { "966,423,1": 38.28, "959,432,1": 36.24, "969,444,1": 21.10, "977,449,1": 11.66, "1000,463,1": 15.26 },
"1000,463,1": { "969,444,1": 36.36, "977,449,1": 26.93, "987,455,1": 15.26 },
"911,467,1": { "933,452,1": 26.63, "924,459,1": 15.26, "902,472,1": 10.30, "888,481,1": 26.93, "896,462,1": 15.81, "896,446,1": 25.81, "897,435,1": 34.93 },
"902,472,1": { "933,452,1": 36.89, "924,459,1": 25.55, "911,467,1": 10.30, "888,481,1": 16.64, "870,483,1": 33.84, "896,462,1": 11.66, "896,446,1": 26.68, "897,435,1": 37.34 },
"731,473,1": { "765,484,1": 35.74, "749,482,1": 20.12, "706,454,1": 31.40, "717,463,1": 17.20, "709,484,1": 24.60, "748,506,1": 37.12, "750,493,1": 27.59 },
"888,481,1": { "911,467,1": 26.93, "902,472,1": 16.64, "870,483,1": 18.11, "851,485,1": 37.22, "896,462,1": 20.62, "896,446,1": 35.90 },
"870,483,1": { "902,472,1": 33.84, "888,481,1": 18.11, "851,485,1": 19.10, "831,485,1": 39.05, "896,462,1": 33.42 },
"851,485,1": { "888,481,1": 37.22, "870,483,1": 19.10, "831,485,1": 20.00 },
"831,485,1": { "870,483,1": 39.05, "851,485,1": 20.00, "809,483,1": 22.09, "798,472,1": 35.47 },
"809,483,1": { "831,485,1": 22.09, "788,483,1": 21.00, "798,472,1": 15.56, "798,457,1": 28.23 },
"788,483,1": { "809,483,1": 21.00, "765,484,1": 23.02, "749,482,1": 39.01, "798,472,1": 14.87, "798,457,1": 27.86, "750,493,1": 39.29 },
"765,484,1": { "731,473,1": 35.74, "788,483,1": 23.02, "749,482,1": 16.12, "798,472,1": 35.11, "748,515,1": 35.36, "748,506,1": 27.80, "750,493,1": 17.49 },
"749,482,1": { "731,473,1": 20.12, "788,483,1": 39.01, "765,484,1": 16.12, "717,463,1": 37.22, "748,515,1": 33.02, "748,506,1": 24.02, "750,493,1": 11.05 },
"798,472,1": { "831,485,1": 35.47, "809,483,1": 15.56, "788,483,1": 14.87, "765,484,1": 35.11, "798,457,1": 15.00 },
"798,457,1": { "809,483,1": 28.23, "788,483,1": 27.86, "798,472,1": 15.00 },
"951,351,1": { "975,319,1": 40.00, "975,329,1": 32.56, "975,342,1": 25.63, "975,352,1": 24.02, "974,368,1": 28.60, "974,381,1": 37.80, "962,351,1": 11.00, "941,353,1": 10.20 },
"962,351,1": { "975,319,1": 34.54, "975,329,1": 25.55, "975,342,1": 15.81, "975,352,1": 13.04, "974,368,1": 20.81, "974,381,1": 32.31, "951,351,1": 11.00, "941,353,1": 21.10 },
"916,238,1": { "895,216,1": 30.41, "904,220,1": 21.63, "910,224,1": 15.23, "923,230,1": 10.63, "932,239,1": 16.03, "944,247,1": 29.41, "913,249,1": 11.40, "910,266,1": 28.64 },
"913,249,1": { "895,216,1": 37.59, "904,220,1": 30.36, "910,224,1": 25.18, "923,230,1": 21.47, "932,239,1": 21.47, "944,247,1": 31.06, "916,238,1": 11.40, "910,266,1": 17.26, "908,280,1": 31.40 },
"910,266,1": { "923,230,1": 38.28, "932,239,1": 34.83, "944,247,1": 38.95, "916,238,1": 28.64, "913,249,1": 17.26, "908,280,1": 14.14, "904,299,1": 33.54 },
"908,280,1": { "913,249,1": 31.40, "910,266,1": 14.14, "904,299,1": 19.42, "902,317,1": 37.48 },
"904,299,1": { "910,266,1": 33.54, "908,280,1": 19.42, "902,317,1": 18.11 },
"902,317,1": { "908,280,1": 37.48, "904,299,1": 18.11, "899,339,1": 22.20, "882,347,1": 36.06 },
"899,339,1": { "902,317,1": 22.20, "882,347,1": 18.79, "902,361,1": 22.20, "891,356,1": 18.79 },
"882,347,1": { "902,317,1": 36.06, "899,339,1": 18.79, "857,346,1": 25.02, "901,381,1": 38.95, "902,361,1": 24.41, "891,356,1": 12.73 },
"857,346,1": { "882,347,1": 25.02, "839,346,1": 18.00, "819,344,1": 38.05, "891,356,1": 35.44 },
"839,346,1": { "857,346,1": 18.00, "819,344,1": 20.10, "805,345,1": 34.01, "803,355,1": 37.11 },
"819,344,1": { "857,346,1": 38.05, "839,346,1": 20.10, "805,345,1": 14.04, "803,355,1": 19.42, "788,348,1": 31.26 },
"805,345,1": { "839,346,1": 34.01, "819,344,1": 14.04, "803,355,1": 10.20, "771,348,1": 34.13, "788,348,1": 17.26 },
"803,355,1": { "839,346,1": 37.11, "819,344,1": 19.42, "805,345,1": 10.20, "771,348,1": 32.76, "788,348,1": 16.55 },
"712,300,1": { "701,301,1": 11.05, "705,337,1": 37.66, "702,321,1": 23.26, "697,289,1": 18.60, "697,281,1": 24.21, "701,265,1": 36.69 },
"701,301,1": { "712,300,1": 11.05, "705,337,1": 36.22, "702,321,1": 20.02, "697,289,1": 12.65, "697,281,1": 20.40, "701,265,1": 36.00 },
"705,337,1": { "712,300,1": 37.66, "701,301,1": 36.22, "702,321,1": 16.28, "717,349,1": 16.97, "736,347,1": 32.57, "704,360,1": 23.02, "697,371,1": 34.93 },
"702,321,1": { "712,300,1": 23.26, "701,301,1": 20.02, "705,337,1": 16.28, "717,349,1": 31.76, "704,360,1": 39.05, "697,289,1": 32.39 },
"717,349,1": { "705,337,1": 16.97, "702,321,1": 31.76, "736,347,1": 19.10, "753,347,1": 36.06, "704,360,1": 17.03, "697,371,1": 29.73 },
"736,347,1": { "705,337,1": 32.57, "717,349,1": 19.10, "753,347,1": 17.00, "771,348,1": 35.01, "704,360,1": 34.54 },
"753,347,1": { "717,349,1": 36.06, "736,347,1": 17.00, "771,348,1": 18.03, "788,348,1": 35.01 },
"771,348,1": { "805,345,1": 34.13, "803,355,1": 32.76, "736,347,1": 35.01, "753,347,1": 18.03, "788,348,1": 17.00 },
"788,348,1": { "819,344,1": 31.26, "805,345,1": 17.26, "803,355,1": 16.55, "753,347,1": 35.01, "771,348,1": 17.00 },
"704,360,1": { "705,337,1": 23.02, "702,321,1": 39.05, "717,349,1": 17.03, "736,347,1": 34.54, "697,371,1": 13.04, "693,388,1": 30.08 },
"697,371,1": { "705,337,1": 34.93, "717,349,1": 29.73, "704,360,1": 13.04, "693,388,1": 17.46, "689,406,1": 35.90 },
"693,388,1": { "704,360,1": 30.08, "697,371,1": 17.46, "689,406,1": 18.44 },
"689,406,1": { "697,371,1": 35.90, "693,388,1": 18.44, "689,428,1": 22.00, "694,441,1": 35.36 },
"689,428,1": { "689,406,1": 22.00, "694,441,1": 13.93, "706,454,1": 31.06 },
"694,441,1": { "689,406,1": 35.36, "689,428,1": 13.93, "706,454,1": 17.69, "717,463,1": 31.83 },
"706,454,1": { "731,473,1": 31.40, "689,428,1": 31.06, "694,441,1": 17.69, "717,463,1": 14.21, "709,484,1": 30.15, "687,485,1": 36.36 },
"717,463,1": { "731,473,1": 17.20, "749,482,1": 37.22, "694,441,1": 31.83, "706,454,1": 14.21, "709,484,1": 22.47, "687,485,1": 37.20 },
"709,484,1": { "731,473,1": 24.60, "706,454,1": 30.15, "717,463,1": 22.47, "687,485,1": 22.02, "672,488,1": 37.22 },
"687,485,1": { "706,454,1": 36.36, "717,463,1": 37.20, "709,484,1": 22.02, "660,488,1": 27.17, "672,488,1": 15.30 },
"660,488,1": { "687,485,1": 27.17, "672,488,1": 12.00, "645,490,1": 15.13, "629,492,1": 31.26 },
"672,488,1": { "709,484,1": 37.22, "687,485,1": 15.30, "660,488,1": 12.00, "645,490,1": 27.07 },
"748,515,1": { "765,484,1": 35.36, "749,482,1": 33.02, "748,506,1": 9.00, "750,493,1": 22.09 },
"748,506,1": { "731,473,1": 37.12, "765,484,1": 27.80, "749,482,1": 24.02, "748,515,1": 9.00, "750,493,1": 13.15 },
"750,493,1": { "731,473,1": 27.59, "788,483,1": 39.29, "765,484,1": 17.49, "749,482,1": 11.05, "748,515,1": 22.09, "748,506,1": 13.15 },
"645,490,1": { "660,488,1": 15.13, "672,488,1": 27.07, "629,492,1": 16.12, "617,495,1": 28.44 },
"629,492,1": { "660,488,1": 31.26, "645,490,1": 16.12, "617,495,1": 12.37, "601,500,1": 29.12 },
"617,495,1": { "645,490,1": 28.44, "629,492,1": 12.37, "601,500,1": 16.76, "584,502,1": 33.73 },
"896,462,1": { "933,452,1": 38.33, "924,459,1": 28.16, "911,467,1": 15.81, "902,472,1": 11.66, "888,481,1": 20.62, "870,483,1": 33.42, "896,446,1": 16.00, "897,435,1": 27.02 },
"896,446,1": { "933,452,1": 37.48, "924,459,1": 30.87, "911,467,1": 25.81, "902,472,1": 26.68, "888,481,1": 35.90, "896,462,1": 16.00, "897,435,1": 11.05, "899,419,1": 27.17, "899,408,1": 38.12 },
"897,435,1": { "933,452,1": 39.81, "924,459,1": 36.12, "911,467,1": 34.93, "902,472,1": 37.34, "896,462,1": 27.02, "896,446,1": 11.05, "899,419,1": 16.12, "899,408,1": 27.07 },
"899,419,1": { "896,446,1": 27.17, "897,435,1": 16.12, "899,408,1": 11.00, "900,394,1": 25.02, "901,381,1": 38.05 },
"899,408,1": { "896,446,1": 38.12, "897,435,1": 27.07, "899,419,1": 11.00, "900,394,1": 14.04, "901,381,1": 27.07 },
"900,394,1": { "899,419,1": 25.02, "899,408,1": 14.04, "901,381,1": 13.04, "902,361,1": 33.06, "891,356,1": 39.05 },
"901,381,1": { "882,347,1": 38.95, "899,419,1": 38.05, "899,408,1": 27.07, "900,394,1": 13.04, "902,361,1": 20.02, "891,356,1": 26.93 },
"902,361,1": { "899,339,1": 22.20, "882,347,1": 24.41, "900,394,1": 33.06, "901,381,1": 20.02, "891,356,1": 12.08, "941,353,1": 39.81 },
"891,356,1": { "899,339,1": 18.79, "882,347,1": 12.73, "857,346,1": 35.44, "900,394,1": 39.05, "901,381,1": 26.93, "902,361,1": 12.08 },
"697,289,1": { "712,300,1": 18.60, "701,301,1": 12.65, "702,321,1": 32.39, "697,281,1": 8.00, "701,265,1": 24.33 },
"697,281,1": { "712,300,1": 24.21, "701,301,1": 20.40, "697,289,1": 8.00, "701,265,1": 16.49, "707,248,1": 34.48 },
"701,265,1": { "712,300,1": 36.69, "701,301,1": 36.00, "697,289,1": 24.33, "697,281,1": 16.49, "707,248,1": 18.03, "719,245,1": 26.91, "701,234,1": 31.00 },
"707,248,1": { "697,281,1": 34.48, "701,265,1": 18.03, "719,245,1": 12.37, "739,242,1": 32.56, "695,217,1": 33.24, "701,234,1": 15.23 },
"719,245,1": { "753,251,1": 34.53, "756,234,1": 38.60, "701,265,1": 26.91, "707,248,1": 12.37, "739,242,1": 20.22, "695,217,1": 36.88, "701,234,1": 21.10 },
"739,242,1": { "753,251,1": 16.64, "756,234,1": 18.79, "759,222,1": 28.28, "707,248,1": 32.56, "719,245,1": 20.22, "701,234,1": 38.83 },
"601,500,1": { "629,492,1": 29.12, "617,495,1": 16.76, "584,502,1": 17.12, "562,503,1": 39.12 },
"584,502,1": { "617,495,1": 33.73, "601,500,1": 17.12, "562,503,1": 22.02 },
"562,503,1": { "601,500,1": 39.12, "584,502,1": 22.02, "544,503,1": 18.00, "527,503,1": 35.00, "545,514,1": 20.25 },
"544,503,1": { "562,503,1": 18.00, "527,503,1": 17.00, "509,503,1": 35.00, "545,514,1": 11.05 },
"527,503,1": { "562,503,1": 35.00, "544,503,1": 17.00, "509,503,1": 18.00, "545,514,1": 21.10 },
"509,503,1": { "544,503,1": 35.00, "527,503,1": 18.00, "545,514,1": 37.64, "488,487,1": 26.40, "487,504,1": 22.02 },
"545,514,1": { "562,503,1": 20.25, "544,503,1": 11.05, "527,503,1": 21.10, "509,503,1": 37.64 },
"549,87,1": { "549,100,1": 13.00, "561,100,1": 17.69, "580,101,1": 34.01, "530,106,1": 26.87 },
"549,100,1": { "549,87,1": 13.00, "561,100,1": 12.00, "580,101,1": 31.02, "530,106,1": 19.92 },
"561,100,1": { "549,87,1": 17.69, "549,100,1": 12.00, "580,101,1": 19.03, "598,101,1": 37.01, "530,106,1": 31.58 },
"580,101,1": { "549,87,1": 34.01, "549,100,1": 31.02, "561,100,1": 19.03, "598,101,1": 18.00 },
"598,101,1": { "629,79,1": 38.01, "627,101,1": 29.00, "561,100,1": 37.01, "580,101,1": 18.00 },
"530,106,1": { "549,87,1": 26.87, "549,100,1": 19.92, "561,100,1": 31.58, "512,122,1": 24.08, "509,113,1": 22.14 },
"512,122,1": { "530,106,1": 24.08, "496,141,1": 24.84, "490,117,1": 22.56, "509,113,1": 9.49 },
"496,141,1": { "512,122,1": 24.84, "487,156,1": 17.49, "477,176,1": 39.82, "469,123,1": 32.45, "490,117,1": 24.74, "509,113,1": 30.87 },
"487,156,1": { "496,141,1": 17.49, "477,176,1": 22.36, "469,123,1": 37.59, "490,117,1": 39.12 },
"477,176,1": { "496,141,1": 39.82, "487,156,1": 22.36, "466,193,1": 20.25, "459,207,1": 35.85 },
"466,193,1": { "477,176,1": 20.25, "459,207,1": 15.65 },
"459,207,1": { "477,176,1": 35.85, "466,193,1": 15.65, "449,233,1": 27.86 },
"449,233,1": { "459,207,1": 27.86, "444,255,1": 22.56, "426,250,1": 28.60 },
"444,255,1": { "449,233,1": 22.56, "443,281,1": 26.02, "411,247,1": 33.96, "426,250,1": 18.68 },
"443,281,1": { "444,255,1": 26.02, "443,302,1": 21.00, "426,250,1": 35.36 },
"443,302,1": { "443,281,1": 21.00, "442,327,1": 25.02 },
"442,327,1": { "443,302,1": 25.02, "441,345,1": 18.03, "441,363,1": 36.01, "423,354,1": 33.02 },
"441,345,1": { "442,327,1": 18.03, "441,363,1": 18.00, "403,354,1": 39.05, "423,354,1": 20.12 },
"441,363,1": { "442,327,1": 36.01, "441,345,1": 18.00, "443,386,1": 23.09, "403,354,1": 39.05, "423,354,1": 20.12 },
"443,386,1": { "441,363,1": 23.09, "452,406,1": 21.93, "423,354,1": 37.74 },
"452,406,1": { "443,386,1": 21.93, "461,428,1": 23.77, "445,445,1": 39.62 },
"461,428,1": { "452,406,1": 23.77, "474,449,1": 24.70, "445,445,1": 23.35 },
"474,449,1": { "461,428,1": 24.70, "482,469,1": 21.54, "445,445,1": 29.27 },
"482,469,1": { "474,449,1": 21.54, "488,487,1": 18.97, "487,504,1": 35.36 },
"488,487,1": { "509,503,1": 26.40, "482,469,1": 18.97, "487,504,1": 17.03, "458,505,1": 34.99 },
"487,504,1": { "509,503,1": 22.02, "482,469,1": 35.36, "488,487,1": 17.03, "458,505,1": 29.02 },
"458,505,1": { "488,487,1": 34.99, "487,504,1": 29.02, "437,505,1": 21.00 },
"437,505,1": { "458,505,1": 21.00, "411,503,1": 26.08 },
"411,503,1": { "437,505,1": 26.08, "387,504,1": 24.02, "379,490,1": 34.54 },
"387,504,1": { "411,503,1": 24.02, "358,500,1": 29.27, "357,513,1": 31.32, "379,469,1": 35.90, "379,490,1": 16.12 },
"358,500,1": { "387,504,1": 29.27, "357,513,1": 13.04, "379,469,1": 37.44, "379,490,1": 23.26, "333,495,1": 25.50 },
"357,513,1": { "387,504,1": 31.32, "358,500,1": 13.04, "379,490,1": 31.83, "333,495,1": 30.00 },
"377,443,1": { "377,454,1": 11.00, "379,469,1": 26.08, "392,456,1": 19.85, "405,456,1": 30.87 },
"377,454,1": { "377,443,1": 11.00, "379,469,1": 15.13, "379,490,1": 36.06, "392,456,1": 15.13, "405,456,1": 28.07 },
"379,469,1": { "387,504,1": 35.90, "358,500,1": 37.44, "377,443,1": 26.08, "377,454,1": 15.13, "379,490,1": 21.00, "392,456,1": 18.38, "405,456,1": 29.07 },
"379,490,1": { "411,503,1": 34.54, "387,504,1": 16.12, "358,500,1": 23.26, "357,513,1": 31.83, "377,454,1": 36.06, "379,469,1": 21.00, "392,456,1": 36.40 },
"392,456,1": { "377,443,1": 19.85, "377,454,1": 15.13, "379,469,1": 18.38, "379,490,1": 36.40, "405,456,1": 13.00, "423,456,1": 31.00 },
"405,456,1": { "377,443,1": 30.87, "377,454,1": 28.07, "379,469,1": 29.07, "392,456,1": 13.00, "423,456,1": 18.00 },
"423,456,1": { "392,456,1": 31.00, "405,456,1": 18.00, "445,445,1": 24.60 },
"445,445,1": { "452,406,1": 39.62, "461,428,1": 23.35, "474,449,1": 29.27, "423,456,1": 24.60 },
"378,353,1": { "389,353,1": 11.00, "403,354,1": 25.02, "379,365,1": 12.04, "378,343,1": 10.00, "349,353,1": 29.00, "365,355,1": 13.15 },
"389,353,1": { "378,353,1": 11.00, "403,354,1": 14.04, "423,354,1": 34.01, "379,365,1": 15.62, "378,343,1": 14.87, "349,353,1": 40.00, "365,355,1": 24.08 },
"403,354,1": { "441,345,1": 39.05, "441,363,1": 39.05, "378,353,1": 25.02, "389,353,1": 14.04, "423,354,1": 20.00, "379,365,1": 26.40, "378,343,1": 27.31, "365,355,1": 38.01 },
"423,354,1": { "442,327,1": 33.02, "441,345,1": 20.12, "441,363,1": 20.12, "443,386,1": 37.74, "389,353,1": 34.01, "403,354,1": 20.00 },
"379,365,1": { "378,353,1": 12.04, "389,353,1": 15.62, "403,354,1": 26.40, "378,343,1": 22.02, "349,353,1": 32.31, "365,355,1": 17.20 },
"378,343,1": { "378,353,1": 10.00, "389,353,1": 14.87, "403,354,1": 27.31, "379,365,1": 22.02, "349,353,1": 30.68, "365,355,1": 17.69 },
"257,354,1": { "272,354,1": 15.00, "257,363,1": 9.00, "257,342,1": 12.00, "244,353,1": 13.04, "226,355,1": 31.02 },
"272,354,1": { "257,354,1": 15.00, "301,352,1": 29.07, "257,363,1": 17.49, "257,342,1": 19.21, "244,353,1": 28.02 },
"301,352,1": { "272,354,1": 29.07, "319,352,1": 18.00, "336,352,1": 35.00, "313,388,1": 37.95, "313,371,1": 22.47, "313,331,1": 24.19, "313,315,1": 38.90 },
"319,352,1": { "301,352,1": 18.00, "336,352,1": 17.00, "349,353,1": 30.02, "313,388,1": 36.50, "313,371,1": 19.92, "313,331,1": 21.84, "313,315,1": 37.48 },
"336,352,1": { "301,352,1": 35.00, "319,352,1": 17.00, "349,353,1": 13.04, "365,355,1": 29.15, "313,371,1": 29.83, "313,331,1": 31.14 },
"349,353,1": { "378,353,1": 29.00, "389,353,1": 40.00, "379,365,1": 32.31, "378,343,1": 30.68, "319,352,1": 30.02, "336,352,1": 13.04, "365,355,1": 16.12 },
"365,355,1": { "378,353,1": 13.15, "389,353,1": 24.08, "403,354,1": 38.01, "379,365,1": 17.20, "378,343,1": 17.69, "336,352,1": 29.15, "349,353,1": 16.12 },
"257,363,1": { "257,354,1": 9.00, "272,354,1": 17.49, "257,342,1": 21.00, "244,353,1": 16.40, "226,355,1": 32.02 },
"257,342,1": { "257,354,1": 12.00, "272,354,1": 19.21, "257,363,1": 21.00, "244,353,1": 17.03, "226,355,1": 33.62 },
"244,353,1": { "257,354,1": 13.04, "272,354,1": 28.02, "257,363,1": 16.40, "257,342,1": 17.03, "226,355,1": 18.11 },
"226,355,1": { "257,354,1": 31.02, "257,363,1": 32.02, "257,342,1": 33.62, "244,353,1": 18.11, "204,367,1": 25.06, "202,344,1": 26.40 },
"204,367,1": { "226,355,1": 25.06, "198,391,1": 24.74, "202,344,1": 23.09 },
"198,391,1": { "204,367,1": 24.74, "198,416,1": 25.00, "179,426,1": 39.82, "190,421,1": 31.05 },
"198,416,1": { "198,391,1": 25.00, "201,433,1": 17.26, "218,450,1": 39.45, "167,432,1": 34.89, "179,426,1": 21.47, "190,421,1": 9.43 },
"201,433,1": { "198,416,1": 17.26, "218,450,1": 24.04, "167,432,1": 34.01, "179,426,1": 23.09, "190,421,1": 16.28 },
"218,450,1": { "198,416,1": 39.45, "201,433,1": 24.04, "241,460,1": 25.08, "251,472,1": 39.66 },
"241,460,1": { "218,450,1": 25.08, "267,479,1": 32.20, "251,472,1": 15.62, "258,456,1": 17.46, "258,446,1": 22.02 },
"267,479,1": { "241,460,1": 32.20, "294,489,1": 28.79, "251,472,1": 17.46, "258,456,1": 24.70, "258,446,1": 34.21 },
"294,489,1": { "267,479,1": 28.79, "333,495,1": 39.46, "312,495,1": 18.97, "312,487,1": 18.11, "312,470,1": 26.17, "312,454,1": 39.36 },
"333,495,1": { "358,500,1": 25.50, "357,513,1": 30.00, "294,489,1": 39.46, "312,495,1": 21.00, "312,487,1": 22.47, "312,470,1": 32.65 },
"312,495,1": { "294,489,1": 18.97, "333,495,1": 21.00, "312,487,1": 8.00, "312,470,1": 25.00 },
"251,472,1": { "218,450,1": 39.66, "241,460,1": 15.62, "267,479,1": 17.46, "258,456,1": 17.46, "258,446,1": 26.93 },
"258,456,1": { "241,460,1": 17.46, "267,479,1": 24.70, "251,472,1": 17.46, "258,446,1": 10.00 },
"258,446,1": { "241,460,1": 22.02, "267,479,1": 34.21, "251,472,1": 26.93, "258,456,1": 10.00 },
"312,487,1": { "294,489,1": 18.11, "333,495,1": 22.47, "312,495,1": 8.00, "312,470,1": 17.00, "312,454,1": 33.00 },
"312,470,1": { "294,489,1": 26.17, "333,495,1": 32.65, "312,495,1": 25.00, "312,487,1": 17.00, "312,454,1": 16.00, "312,437,1": 33.00 },
"312,454,1": { "294,489,1": 39.36, "312,487,1": 33.00, "312,470,1": 16.00, "312,437,1": 17.00, "312,416,1": 38.00 },
"312,437,1": { "312,470,1": 33.00, "312,454,1": 17.00, "312,416,1": 21.00, "313,400,1": 37.01 },
"312,416,1": { "312,454,1": 38.00, "312,437,1": 21.00, "313,400,1": 16.03, "313,388,1": 28.02 },
"313,400,1": { "312,437,1": 37.01, "312,416,1": 16.03, "313,388,1": 12.00, "313,371,1": 29.00 },
"313,388,1": { "301,352,1": 37.95, "319,352,1": 36.50, "312,416,1": 28.02, "313,400,1": 12.00, "313,371,1": 17.00 },
"313,371,1": { "301,352,1": 22.47, "319,352,1": 19.92, "336,352,1": 29.83, "313,400,1": 29.00, "313,388,1": 17.00, "313,331,1": 40.00 },
"313,331,1": { "301,352,1": 24.19, "319,352,1": 21.84, "336,352,1": 31.14, "313,371,1": 40.00, "313,315,1": 16.00, "313,299,1": 32.00 },
"313,315,1": { "301,352,1": 38.90, "319,352,1": 37.48, "313,331,1": 16.00, "313,299,1": 16.00, "313,283,1": 32.00 },
"313,299,1": { "313,331,1": 32.00, "313,315,1": 16.00, "313,283,1": 16.00, "317,266,1": 33.24 },
"313,283,1": { "313,315,1": 32.00, "313,299,1": 16.00, "317,266,1": 17.46, "329,254,1": 33.12, "305,245,1": 38.83 },
"317,266,1": { "313,299,1": 33.24, "313,283,1": 17.46, "329,254,1": 16.97, "350,245,1": 39.12, "305,245,1": 24.19, "289,246,1": 34.41 },
"329,254,1": { "313,283,1": 33.12, "317,266,1": 16.97, "350,245,1": 22.85, "305,245,1": 25.63 },
"350,245,1": { "317,266,1": 39.12, "329,254,1": 22.85, "373,245,1": 23.00, "381,258,1": 33.62, "379,232,1": 31.78, "376,221,1": 35.38 },
"373,245,1": { "350,245,1": 23.00, "394,247,1": 21.10, "411,247,1": 38.05, "381,258,1": 15.26, "379,232,1": 14.32, "376,221,1": 24.19 },
"394,247,1": { "373,245,1": 21.10, "411,247,1": 17.00, "426,250,1": 32.14, "381,258,1": 17.03, "379,232,1": 21.21, "376,221,1": 31.62 },
"411,247,1": { "444,255,1": 33.96, "373,245,1": 38.05, "394,247,1": 17.00, "426,250,1": 15.30, "381,258,1": 31.95, "379,232,1": 35.34 },
"426,250,1": { "449,233,1": 28.60, "444,255,1": 18.68, "443,281,1": 35.36, "394,247,1": 32.14, "411,247,1": 15.30 },
"381,258,1": { "350,245,1": 33.62, "373,245,1": 15.26, "394,247,1": 17.03, "411,247,1": 31.95, "379,232,1": 26.08, "376,221,1": 37.34 },
"379,232,1": { "350,245,1": 31.78, "373,245,1": 14.32, "394,247,1": 21.21, "411,247,1": 35.34, "381,258,1": 26.08, "376,221,1": 11.40 },
"376,221,1": { "350,245,1": 35.38, "373,245,1": 24.19, "394,247,1": 31.62, "381,258,1": 37.34, "379,232,1": 11.40 },
"233,245,1": { "250,244,1": 17.03, "268,242,1": 35.13, "213,250,1": 20.62, "198,261,1": 38.48, "204,243,1": 29.07, "211,229,1": 27.20, "224,214,1": 32.28 },
"250,244,1": { "233,245,1": 17.03, "268,242,1": 18.11, "279,243,1": 29.02, "289,246,1": 39.05, "213,250,1": 37.48, "224,214,1": 39.70, "261,275,1": 32.89 },
"268,242,1": { "233,245,1": 35.13, "250,244,1": 18.11, "279,243,1": 11.05, "305,245,1": 37.12, "289,246,1": 21.38, "261,275,1": 33.73 },
"279,243,1": { "250,244,1": 29.02, "268,242,1": 11.05, "305,245,1": 26.08, "289,246,1": 10.44, "261,275,1": 36.72 },
"305,245,1": { "313,283,1": 38.83, "317,266,1": 24.19, "329,254,1": 25.63, "268,242,1": 37.12, "279,243,1": 26.08, "289,246,1": 16.03 },
"289,246,1": { "317,266,1": 34.41, "250,244,1": 39.05, "268,242,1": 21.38, "279,243,1": 10.44, "305,245,1": 16.03 },
"213,250,1": { "233,245,1": 20.62, "250,244,1": 37.48, "201,272,1": 25.06, "182,252,1": 31.06, "198,261,1": 18.60, "204,243,1": 11.40, "211,229,1": 21.10, "224,214,1": 37.64 },
"201,272,1": { "213,250,1": 25.06, "201,297,1": 25.00, "182,252,1": 27.59, "198,261,1": 11.40, "204,243,1": 29.15 },
"201,297,1": { "201,272,1": 25.00, "201,322,1": 25.00, "198,261,1": 36.12 },
"201,322,1": { "201,297,1": 25.00, "202,344,1": 22.02 },
"202,344,1": { "226,355,1": 26.40, "204,367,1": 23.09, "201,322,1": 22.02 },
"152,239,1": { "168,245,1": 17.09, "182,252,1": 32.70 },
"168,245,1": { "152,239,1": 17.09, "182,252,1": 15.65, "198,261,1": 34.00, "204,243,1": 36.06 },
"182,252,1": { "213,250,1": 31.06, "201,272,1": 27.59, "152,239,1": 32.70, "168,245,1": 15.65, "198,261,1": 18.36, "204,243,1": 23.77, "211,229,1": 37.01 },
"198,261,1": { "233,245,1": 38.48, "213,250,1": 18.60, "201,272,1": 11.40, "201,297,1": 36.12, "168,245,1": 34.00, "182,252,1": 18.36, "204,243,1": 18.97, "211,229,1": 34.54 },
"156,439,1": { "167,432,1": 13.04, "179,426,1": 26.42, "190,421,1": 38.47 },
"167,432,1": { "198,416,1": 34.89, "201,433,1": 34.01, "156,439,1": 13.04, "179,426,1": 13.42, "190,421,1": 25.50 },
"179,426,1": { "198,391,1": 39.82, "198,416,1": 21.47, "201,433,1": 23.09, "156,439,1": 26.42, "167,432,1": 13.42, "190,421,1": 12.08 },
"190,421,1": { "198,391,1": 31.05, "198,416,1": 9.43, "201,433,1": 16.28, "156,439,1": 38.47, "167,432,1": 25.50, "179,426,1": 12.08 },
"204,243,1": { "233,245,1": 29.07, "213,250,1": 11.40, "201,272,1": 29.15, "168,245,1": 36.06, "182,252,1": 23.77, "198,261,1": 18.97, "211,229,1": 15.65, "224,214,1": 35.23 },
"211,229,1": { "233,245,1": 27.20, "213,250,1": 21.10, "182,252,1": 37.01, "198,261,1": 34.54, "204,243,1": 15.65, "224,214,1": 19.85 },
"224,214,1": { "233,245,1": 32.28, "250,244,1": 39.70, "213,250,1": 37.64, "204,243,1": 35.23, "211,229,1": 19.85, "246,204,1": 24.17, "257,199,1": 36.25 },
"246,204,1": { "224,214,1": 24.17, "282,192,1": 37.95, "257,199,1": 12.08 },
"282,192,1": { "246,204,1": 37.95, "257,199,1": 25.96, "308,175,1": 31.06, "296,183,1": 16.64 },
"257,199,1": { "224,214,1": 36.25, "246,204,1": 12.08, "282,192,1": 25.96 },
"308,175,1": { "282,192,1": 31.06, "296,183,1": 14.42, "332,169,1": 24.74, "345,164,1": 38.60 },
"296,183,1": { "282,192,1": 16.64, "308,175,1": 14.42, "332,169,1": 38.63 },
"332,169,1": { "308,175,1": 24.74, "296,183,1": 38.63, "345,164,1": 13.93, "355,157,1": 25.94, "358,142,1": 37.48 },
"345,164,1": { "308,175,1": 38.60, "332,169,1": 13.93, "355,157,1": 12.21, "372,152,1": 29.55, "352,133,1": 31.78, "358,142,1": 25.55 },
"355,157,1": { "332,169,1": 25.94, "345,164,1": 12.21, "372,152,1": 17.72, "352,133,1": 24.19, "358,142,1": 15.30 },
"372,152,1": { "345,164,1": 29.55, "355,157,1": 17.72, "394,141,1": 24.60, "352,133,1": 27.59, "358,142,1": 17.20 },
"394,141,1": { "372,152,1": 24.60, "419,133,1": 26.25, "430,129,1": 37.95, "358,142,1": 36.01 },
"419,133,1": { "394,141,1": 26.25, "430,129,1": 11.70, "448,125,1": 30.08, "432,97,1": 38.28, "439,112,1": 29.00 },
"430,129,1": { "394,141,1": 37.95, "419,133,1": 11.70, "448,125,1": 18.44, "469,123,1": 39.46, "432,97,1": 32.06, "439,112,1": 19.24 },
"448,125,1": { "419,133,1": 30.08, "430,129,1": 18.44, "469,123,1": 21.10, "432,97,1": 32.25, "439,112,1": 15.81 },
"469,123,1": { "496,141,1": 32.45, "487,156,1": 37.59, "430,129,1": 39.46, "448,125,1": 21.10, "490,117,1": 21.84, "439,112,1": 31.95 },
"490,117,1": { "512,122,1": 22.56, "496,141,1": 24.74, "487,156,1": 39.12, "469,123,1": 21.84, "509,113,1": 19.42 },
"509,113,1": { "530,106,1": 22.14, "512,122,1": 9.49, "496,141,1": 30.87, "490,117,1": 19.42 },
"352,133,1": { "345,164,1": 31.78, "355,157,1": 24.19, "372,152,1": 27.59, "358,142,1": 10.82 },
"358,142,1": { "332,169,1": 37.48, "345,164,1": 25.55, "355,157,1": 15.30, "372,152,1": 17.20, "394,141,1": 36.01, "352,133,1": 10.82 },
"432,97,1": { "419,133,1": 38.28, "430,129,1": 32.06, "448,125,1": 32.25, "439,112,1": 16.55 },
"439,112,1": { "419,133,1": 29.00, "430,129,1": 19.24, "448,125,1": 15.81, "469,123,1": 31.95, "432,97,1": 16.55 },
"643,125,1": { "627,101,1": 28.84, "665,120,1": 22.56, "650,140,1": 16.55 },
"650,140,1": { "665,120,1": 25.00, "688,131,1": 39.05, "643,125,1": 16.55, "661,161,1": 23.71 },
"661,161,1": { "650,140,1": 23.71, "669,177,1": 17.89, "681,190,1": 35.23 },
"669,177,1": { "661,161,1": 17.89, "681,190,1": 17.69 },
"681,190,1": { "661,161,1": 35.23, "669,177,1": 17.69, "695,217,1": 30.41 },
"695,217,1": { "707,248,1": 33.24, "719,245,1": 36.88, "681,190,1": 30.41, "701,234,1": 18.03 },
"701,234,1": { "701,265,1": 31.00, "707,248,1": 15.23, "719,245,1": 21.10, "739,242,1": 38.83, "695,217,1": 18.03 },
"261,275,1": { "250,244,1": 32.89, "268,242,1": 33.73, "279,243,1": 36.72 },
"941,353,1": { "975,342,1": 35.74, "975,352,1": 34.01, "974,368,1": 36.25, "951,351,1": 10.20, "962,351,1": 21.10, "902,361,1": 39.81 },

  // ... other floor 1 nodes ...
  
  // Floor 2 nodes
 "634,69,2": { "634,92,2": 23.00 },
"634,92,2": { "634,69,2": 23.00, "673,99,2": 39.62 },
"673,99,2": { "634,92,2": 39.62, "706,109,2": 34.48 },
"706,109,2": { "673,99,2": 34.48, "726,119,2": 22.36 },
"726,119,2": { "706,109,2": 22.36, "756,131,2": 32.31 },
"756,131,2": { "726,119,2": 32.31, "794,141,2": 39.29 },
"794,141,2": { "756,131,2": 39.29, "827,162,2": 39.12 },
"827,162,2": { "794,141,2": 39.12, "857,178,2": 34.00 },
"857,178,2": { "827,162,2": 34.00, "885,197,2": 33.84 },
"885,197,2": { "857,178,2": 33.84, "896,223,2": 28.23 },
"896,223,2": { "885,197,2": 28.23, "907,252,2": 31.02 },
"907,252,2": { "896,223,2": 31.02, "903,280,2": 28.28 },
"903,280,2": { "907,252,2": 28.28, "903,303,2": 23.00 },
"903,303,2": { "903,280,2": 23.00, "902,333,2": 30.02 },
"902,333,2": { "903,303,2": 30.02, "975,342,2": 33.73, "867,351,2": 39.36, "897,355,2": 22.56 },
"975,342,2": { "902,333,2": 33.73 },
"716,159,2": { "709,197,2": 38.64 },
"709,197,2": { "716,159,2": 38.64 },
"699,243,2": { "698,277,2": 34.01 },
"698,277,2": { "699,243,2": 34.01, "698,316,2": 39.00 },
"698,316,2": { "698,277,2": 39.00, "708,347,2": 32.57 },
"708,347,2": { "698,316,2": 32.57, "730,347,2": 22.00 },
"730,347,2": { "708,347,2": 22.00, "759,347,2": 29.00 },
"759,347,2": { "730,347,2": 29.00, "784,347,2": 25.00 },
"784,347,2": { "759,347,2": 25.00, "813,347,2": 29.00 },
"813,347,2": { "784,347,2": 29.00, "841,350,2": 28.16 },
"841,350,2": { "813,347,2": 28.16, "867,351,2": 26.02 },
"867,351,2": { "902,333,2": 39.36, "841,350,2": 26.02, "897,355,2": 30.27 },
"897,355,2": { "902,333,2": 22.56, "867,351,2": 30.27 }
};

// A* Pathfinding Algorithm

const heuristic = (a, b) => {
  const [x1, y1] = a.split(",").map(Number);
  const [x2, y2] = b.split(",").map(Number);
  return Math.hypot(x2 - x1, y2 - y1);
};

const aStar = (graph, start, end) => {
  const openSet = [start];
  const closedSet = new Set();
  const cameFrom = {};
  const gScore = { [start]: 0 };
  const fScore = { [start]: heuristic(start, end) };

  const getLowestFScore = () =>
    openSet.reduce((lowest, node) =>
      fScore[node] < fScore[lowest] ? node : lowest
    );

  const reconstructPath = (current) => {
    const path = [current];
    while (current in cameFrom) {
      current = cameFrom[current];
      path.unshift(current);
    }
    return path;
  };

  while (openSet.length > 0) {
    const current = getLowestFScore();
    if (current === end) {
      return reconstructPath(current);
    }

    openSet.splice(openSet.indexOf(current), 1);
    closedSet.add(current);

    for (const neighbor in graph[current] || {}) {
      if (closedSet.has(neighbor)) continue;
      const tentativeGScore = gScore[current] + graph[current][neighbor];
      if (tentativeGScore < (gScore[neighbor] || Infinity)) {
        cameFrom[neighbor] = current;
        gScore[neighbor] = tentativeGScore;
        fScore[neighbor] = gScore[neighbor] + heuristic(neighbor, end);
        if (!openSet.includes(neighbor)) {
          openSet.push(neighbor);
        }
      }
    }
  }
  return null;
};



// Define transition nodes (elevators/escalators) for each floor
const transitionNodes = {
  1: [{ x: 975, y: 342, z: 1 }], // Floor 1 transition points
  2: [{ x: 975, y: 342, z: 2 }], // Floor 2 transition points
};

// Function to find nearest transition node
const findNearestTransitionNode = (point, floorNumber) => {
  const [x, y] = point.split(',').map(Number);
  const floorTransitions = transitionNodes[floorNumber];
  
  return floorTransitions.reduce((nearest, node) => {
    const distance = Math.hypot(node.x - x, node.y - y);
    if (!nearest || distance < nearest.distance) {
      return { node, distance };
    }
    return nearest;
  }, null).node;
};

const MapComponent = () => {
  const mapRef = useRef(null);
  const [activeMap, setActiveMap] = useState(1);
  const [vectorLayer, setVectorLayer] = useState(null);
  const [startNode, setStartNode] = useState("");
  const [endNode, setEndNode] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [snackbarMessage, setSnackbarMessage] = useState("");
  const [snackbarOpen, setSnackbarOpen] = useState(false);

  const mapConfigs = [
    {
      extent: [0, 0, 1152, 648],
      center: [576, 324],
      zoom: 2,
      svgUrl: "/Ground Demo (1).svg",
      mapNumber: 1
    },
    {
      extent: [0, 0, 1152, 648],
      center: [576, 324],
      zoom: 2,
      svgUrl: "/First Demo (1).svg",
      mapNumber: 2
    },
  
  ]

  // Initialize map
  useEffect(() => {
    if (mapRef.current) return;

    const { extent, center, zoom, svgUrl } = mapConfigs[activeMap - 1];
    const vectorSource = new VectorSource();
    const vectorLayerInstance = new VectorLayer({
      source: vectorSource,
    });

    const mapInstance = new Map({
      target: "map",
      layers: [
        new ImageLayer({
          source: new Static({
            url: svgUrl,
            imageExtent: extent,
          }),
        }),
        vectorLayerInstance,
      ],
      view: new View({
        center: center,
        zoom: zoom,
        extent: extent,
      }),
    });

    mapRef.current = mapInstance;
    setVectorLayer(vectorLayerInstance);
  }, [activeMap]);

  // Handle map changes
  const handleMapChange = (mapNumber) => {
    const { extent, svgUrl } = mapConfigs[mapNumber - 1];
    
    if (mapRef.current) {
      // Update the image layer
      const layers = mapRef.current.getLayers();
      const imageLayer = new ImageLayer({
        source: new Static({
          url: svgUrl,
          imageExtent: extent,
        }),
      });
      
      // Remove old layers and add new ones
      layers.clear();
      layers.push(imageLayer);
      
      // Create new vector layer for the paths
      const newVectorSource = new VectorSource();
      const newVectorLayer = new VectorLayer({ source: newVectorSource });
      layers.push(newVectorLayer);
      setVectorLayer(newVectorLayer);
    }
    
    setActiveMap(mapNumber);
  };

  //component for man-icon
  const animateManIcon = (pathCoords, vectorSource) => {
    let currentIndex = 0;

    // Feature for the man icon
    const manFeature = new Feature({
      geometry: new Point(pathCoords[currentIndex]),
    });

    manFeature.setStyle(
      new Style({
        image: new Icon({
          src: "https://static.thenounproject.com/png/429544-200.png", // Path to your man icon image
          scale: 0.05, // Scale the icon to fit the map
          anchor: [0.5, 0.5], // Center the icon
        }),
      })
    );

    vectorSource.addFeature(manFeature);

    const animate = () => {
      if (currentIndex >= pathCoords.length - 1) {
        return; // Animation ends
      }

      currentIndex++;
      manFeature.getGeometry().setCoordinates(pathCoords[currentIndex]);

      requestAnimationFrame(animate);
    };

    animate();
  };

  //display animated path
  const animateTrailGradientAndDashed = (coordinates) => {
    const trailSource = new VectorSource();
    const trailLayer = new VectorLayer({
      source: trailSource,
      style: (feature) => {
        const progress = feature.get("progress") || 0;
        const startColor = [63, 94, 251];
        const endColor = [252, 70, 107];
        const interpolatedColor = startColor.map((start, i) =>
          Math.round(start + progress * (endColor[i] - start))
        );
  
        return new Style({
          stroke: new Stroke({
            color: `rgba(${interpolatedColor.join(",")}, 1)`,
            width: 5,
            lineDash: [3, 4], // Dashed line
            lineDashOffset: feature.get("dashOffset") || 0, // Moving dash offset
            lineCap: "round",
            lineJoin: "round",
          }),
        });
      },
    });
    mapRef.current.addLayer(trailLayer);
  
    const stepInterval = 50;
    const totalSteps = 100;
    let currentStep = 0;
    let dashOffset = 0; // Initial dash offset
  
    const animateStep = () => {
      if (currentStep > totalSteps) return;
  
      const progress = currentStep / totalSteps;
      trailSource.clear();
      const partialCoordinates = coordinates.slice(
        0,
        Math.ceil(progress * coordinates.length)
      );
      const trailFeature = new Feature(new LineString(partialCoordinates));
      trailFeature.set("progress", progress);
      trailFeature.set("dashOffset", dashOffset); // Update dash offset
      
      trailSource.addFeature(trailFeature);
      
      dashOffset -= 0.5; // Smoother dash animation (reduced value)
      currentStep++;
      
      if (currentStep <= totalSteps) {
        setTimeout(animateStep, stepInterval);
      }
    };
  
    animateStep();
  };

  //calculate and display path
  const calculatePath = async () => {
    if (!startNode || !endNode) {
      setSnackbarMessage("Please enter both start and end points");
      setSnackbarOpen(true);
      return;
    }
    
    //obtain x,y,z coorinates of start and end node
    const [startX, startY, startZ] = startNode.split(",").map(Number);
    const [endX, endY, endZ] = endNode.split(",").map(Number);
  
      if (startZ === endZ) {
        setIsLoading(true);
        const path = aStar(graph, startNode, endNode);
        setIsLoading(false);

        if (!path) {
          alert("No path found!");
          return;
        }
      
      /*handleMapChange(startZ);
      const coordinates = path.map((node) => node.split(",").map(Number));
      vectorLayer.getSource().clear();*/
      const coordinates = path.map((node) => node.split(",").map(Number));
       handleMapChange(startZ);
       vectorLayer.getSource().clear();
       animateTrailGradientAndDashed(coordinates.filter(([x, y, z]) => z === startZ));
    
      }

       
        
      

      else {
        // Multi-floor navigation
        // 1. Find path to nearest transition node on start floor
        const startFloorTransition = findNearestTransitionNode(startNode, startZ);
        const transitionNodeStart = `${startFloorTransition.x},${startFloorTransition.y},${startZ}`;
        const pathToTransition = aStar(graph, startNode, transitionNodeStart); 
      
        // 2. Find path from transition node on end floor to destination
        const endFloorTransition = findNearestTransitionNode(endNode, endZ);
        const transitionNodeEnd = `${endFloorTransition.x},${endFloorTransition.y},${endZ}`;
        const pathFromTransition = aStar(graph, transitionNodeEnd, endNode);

       // Combine pathToTransition and pathFromTransition
       const fullPath = pathToTransition.concat(pathFromTransition);

       // Create floorPaths and process the combined path
       const floorPaths = {};
       fullPath.forEach((node) => {
       const [x, y, z] = node.split(",");
       if (!floorPaths[z]) floorPaths[z] = [];
       floorPaths[z].push([Number(x), Number(y)]); // Store x, y as a pair under the respective floor (z)
      });
       //console.log(floorPaths);
       //for (const[z, coordinates] of Object.entries(floorPaths)){await}
       const coordinates = fullPath.map((node) => node.split(",").map(Number));
       handleMapChange(startZ);
       vectorLayer.getSource().clear();
       animateTrailGradientAndDashed(coordinates.filter(([x, y, z]) => z === startZ));

       //draw second path
       setTimeout(()=>{
        handleMapChange(endZ);
        vectorLayer.getSource().clear();
        animateTrailGradientAndDashed(coordinates.filter(([x, y, z]) => z === endZ));
       },6500)

     };
       /* Call renderPath and show a success message
       renderPath(floorPaths);
       setSnackbarMessage("Path calculated successfully!");
       setSnackbarOpen(true);
      };  

       // Function to render paths on the map
       const renderPath = (floorPaths) => {
       const vectorSource = mapRef.current.vectorLayer.getSource();
       vectorSource.clear(); // Clear any existing paths

       // Iterate over floorPaths to render the paths for the current floor
       Object.entries(floorPaths).forEach(([z, coordinates]) => {
       if (parseInt(z) === currentFloor) {
       const pathFeature = new Feature(new LineString(coordinates));
       pathFeature.setStyle(
        new Style({
          stroke: new Stroke({
            color: "#21005D", // Define the path color
            width: 3,        // Define the path thickness
          }),
        })
      );
       vectorSource.addFeature(pathFeature); // Add the rendered path feature to the map
      }
    });
 };
}; //try closed
}; //calculatepath closed*/
}; //close constPath


return (
   /* <Box sx={{ padding: 2 }}>
      <Typography variant="h4" gutterBottom>
        Multi-floor Navigation
      </Typography>
      
      <Box sx={{ marginBottom: 2 }}>
        <Button onClick={() => handleMapChange(1)}>Floor 1</Button>
        <Button onClick={() => handleMapChange(2)}>Floor 2</Button>
        <Button onClick={() => handleMapChange(3)}>Floor 3</Button>
      </Box>

      <Box sx={{ display: 'flex', gap: 2, marginBottom: 2 }}>
        <TextField
          label="Start Point (x,y,z)"
          value={startNode}
          onChange={(e) => setStartNode(e.target.value)}
        />
        <TextField
          label="End Point (x,y,z)"
          value={endNode}
          onChange={(e) => setEndNode(e.target.value)}
        />
        <Button
          variant="contained"
          onClick={calculatePath}
          disabled={isLoading}
        >
          {isLoading ? <CircularProgress size={24} /> : "Find Path"}
        </Button>
      </Box>

      <div id="map" style={{ width: '100%', height: '600px' }} />

      <Snackbar
        open={snackbarOpen}
        autoHideDuration={6000}
        onClose={() => setSnackbarOpen(false)}
      >
        <Alert severity="info" onClose={() => setSnackbarOpen(false)}>
          {snackbarMessage}
        </Alert>
      </Snackbar>
    </Box>*/
    <div>
      <h2>INDOOR NAVIGATION SYSTEM</h2>
      <div style={{ margin: "10px" }}>
        <label>
          Start Node:{" "}
          <input
            type="text"
            value={startNode}
            onChange={(e) => setStartNode(e.target.value)}
            
          />
        </label>
        <label style={{ marginLeft: "10px" }}>
          End Node:{" "}
          <input
            type="text"
            value={endNode}
            onChange={(e) => setEndNode(e.target.value)}
            
          />
        </label>
        <button onClick={calculatePath} style={{ marginLeft: "10px" }}>
          {isLoading ? "Calculating..." : "Calculate Path"}
        </button>
      </div>
      <div id="map" style={{ width: "100%", height: "500px" }}></div>
    </div>
);
};
export default MapComponent;